var map,ahora,antess,afterMap,beforeMap,mag1=["<",["get","mag"],2],mag2=["all",[">=",["get","mag"],2],["<",["get","mag"],3]],mag3=["all",[">=",["get","mag"],3],["<",["get","mag"],4]],mag4=["all",[">=",["get","mag"],4],["<",["get","mag"],5]],mag5=[">=",["get","mag"],5],colors=["#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c"];function myTest(a){mapboxgl.accessToken="pk.eyJ1IjoieGF2aW5vb2IiLCJhIjoiY2s0Mzh4bXZuMDN1NzNpcnJndXVzOXV2MiJ9.IQ7TZdyB6OnCy-8m7mqVhQ",(map=new mapboxgl.Map({container:"map",zoom:6,center:[-79.8927486,-2.3170432],style:"mapbox://styles/mapbox/dark-v10"})).addControl(new mapboxgl.NavigationControl),map.on("load",(function(){map.addSource("earthquakes",{type:"geojson",data:`https://covid-03-beta.herokuapp.com/Contagios/cordenada/${a}`,cluster:!0,clusterRadius:80,clusterProperties:{mag1:["+",["case",mag1,1,0]],mag2:["+",["case",mag2,1,0]],mag3:["+",["case",mag3,1,0]],mag4:["+",["case",mag4,1,0]],mag5:["+",["case",mag5,1,0]]}}),map.addLayer({id:"earthquake_circle",type:"circle",source:"earthquakes",filter:["!=","cluster",!0],paint:{"circle-color":["case",mag1,colors[0],mag2,colors[1],mag3,colors[2],mag4,colors[3],colors[4]],"circle-opacity":.6,"circle-radius":12}}),map.addLayer({id:"earthquake_label",type:"symbol",source:"earthquakes",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","mag"],{"min-fraction-digits":1,"max-fraction-digits":1}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var e={},t={};function o(){for(var a={},o=map.querySourceFeatures("earthquakes"),r=0;r<o.length;r++){var c=o[r].geometry.coordinates,n=o[r].properties;if(n.cluster){var i=n.cluster_id,s=e[i];if(!s){var l=createDonutChart(n);s=e[i]=new mapboxgl.Marker({element:l}).setLngLat(c)}a[i]=s,t[i]||s.addTo(map)}}for(i in t)a[i]||t[i].remove();t=a}map.on("data",(function(a){"earthquakes"===a.sourceId&&a.isSourceLoaded&&(map.on("move",o),map.on("moveend",o),o())}))}))}function createDonutChart(a){for(var e=[],t=[a.mag1,a.mag2,a.mag3,a.mag4,a.mag5],o=0,r=0;r<t.length;r++)e.push(o),o+=t[r];var c=o>=1e3?22:o>=100?20:o>=10?18:16,n=o>=1e3?50:o>=100?32:o>=10?24:18,i=Math.round(.6*n),s=2*n,l='<div><svg width="'+s+'" height="'+s+'" viewbox="0 0 '+s+" "+s+'" text-anchor="middle" style="font: '+c+'px sans-serif">';for(r=0;r<t.length;r++)l+=donutSegment(e[r]/o,(e[r]+t[r])/o,n,i,colors[r]);l+='<circle cx="'+n+'" cy="'+n+'" r="'+i+'" fill="white" /><text dominant-baseline="central" transform="translate('+n+", "+n+')">'+o.toLocaleString()+"</text></svg></div>";var m=document.createElement("div");return m.innerHTML=l,m.firstChild}function donutSegment(a,e,t,o,r){e-a==1&&(e-=1e-5);var c=2*Math.PI*(a-.25),n=2*Math.PI*(e-.25),i=Math.cos(c),s=Math.sin(c),l=Math.cos(n),m=Math.sin(n),g=e-a>.5?1:0;return['<path d="M',t+o*i,t+o*s,"L",t+t*i,t+t*s,"A",t,t,0,g,1,t+t*l,t+t*m,"L",t+o*l,t+o*m,"A",o,o,0,g,0,t+o*i,t+o*s,'" fill="'+r+'" />'].join(" ")}function carga(a,e){ahora=a,antess=e,mapboxgl.accessToken="pk.eyJ1IjoieGF2aW5vb2IiLCJhIjoiY2s0Mzh4bXZuMDN1NzNpcnJndXVzOXV2MiJ9.IQ7TZdyB6OnCy-8m7mqVhQ",beforeMap=new mapboxgl.Map({container:"before",style:"mapbox://styles/mapbox/light-v10",center:[-79.8927486,-2.3170432],zoom:6}),sol(),afterMap=new mapboxgl.Map({container:"after",style:"mapbox://styles/mapbox/dark-v10",center:[-79.8927486,-2.3170432],zoom:6}),sol1(),new mapboxgl.Compare(beforeMap,afterMap,"#comparison-container",{})}function sol(){beforeMap.addControl(new mapboxgl.NavigationControl),beforeMap.on("load",(function(){beforeMap.addSource("earthquakes",{type:"geojson",data:`https://covid-03-beta.herokuapp.com/Contagios/cordenada/${antess}`,cluster:!0,clusterRadius:80,clusterProperties:{mag1:["+",["case",mag1,1,0]],mag2:["+",["case",mag2,1,0]],mag3:["+",["case",mag3,1,0]],mag4:["+",["case",mag4,1,0]],mag5:["+",["case",mag5,1,0]]}}),beforeMap.addLayer({id:"earthquake_circle",type:"circle",source:"earthquakes",filter:["!=","cluster",!0],paint:{"circle-color":["case",mag1,colors[0],mag2,colors[1],mag3,colors[2],mag4,colors[3],colors[4]],"circle-opacity":.6,"circle-radius":12}}),beforeMap.addLayer({id:"earthquake_label",type:"symbol",source:"earthquakes",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","mag"],{"min-fraction-digits":1,"max-fraction-digits":1}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var a={},e={};function t(){for(var t={},o=beforeMap.querySourceFeatures("earthquakes"),r=0;r<o.length;r++){var c=o[r].geometry.coordinates,n=o[r].properties;if(n.cluster){var i=n.cluster_id,s=a[i];if(!s){var l=createDonutChart(n);s=a[i]=new mapboxgl.Marker({element:l}).setLngLat(c)}t[i]=s,e[i]||s.addTo(beforeMap)}}for(i in e)t[i]||e[i].remove();e=t}beforeMap.on("data",(function(a){"earthquakes"===a.sourceId&&a.isSourceLoaded&&(beforeMap.on("move",t),beforeMap.on("moveend",t),t())}))}))}function sol1(){afterMap.addControl(new mapboxgl.NavigationControl),afterMap.on("load",(function(){afterMap.addSource("earthquakes",{type:"geojson",data:`https://covid-03-beta.herokuapp.com/Contagios/cordenada/${ahora}`,cluster:!0,clusterRadius:80,clusterProperties:{mag1:["+",["case",mag1,1,0]],mag2:["+",["case",mag2,1,0]],mag3:["+",["case",mag3,1,0]],mag4:["+",["case",mag4,1,0]],mag5:["+",["case",mag5,1,0]]}}),afterMap.addLayer({id:"earthquake_circle",type:"circle",source:"earthquakes",filter:["!=","cluster",!0],paint:{"circle-color":["case",mag1,colors[0],mag2,colors[1],mag3,colors[2],mag4,colors[3],colors[4]],"circle-opacity":.6,"circle-radius":12}}),afterMap.addLayer({id:"earthquake_label",type:"symbol",source:"earthquakes",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","mag"],{"min-fraction-digits":1,"max-fraction-digits":1}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":["case",["<",["get","mag"],3],"black","white"]}});var a={},e={};function t(){for(var t={},o=afterMap.querySourceFeatures("earthquakes"),r=0;r<o.length;r++){var c=o[r].geometry.coordinates,n=o[r].properties;if(n.cluster){var i=n.cluster_id,s=a[i];if(!s){var l=createDonutChart(n);s=a[i]=new mapboxgl.Marker({element:l}).setLngLat(c)}t[i]=s,e[i]||s.addTo(afterMap)}}for(i in e)t[i]||e[i].remove();e=t}afterMap.on("data",(function(a){"earthquakes"===a.sourceId&&a.isSourceLoaded&&(afterMap.on("move",t),afterMap.on("moveend",t),t())}))}))}function createDonutChart(a){for(var e=[],t=[a.mag1,a.mag2,a.mag3,a.mag4,a.mag5],o=0,r=0;r<t.length;r++)e.push(o),o+=t[r];var c=o>=1e3?22:o>=100?20:o>=10?18:16,n=o>=1e3?50:o>=100?32:o>=10?24:18,i=Math.round(.6*n),s=2*n,l='<div><svg width="'+s+'" height="'+s+'" viewbox="0 0 '+s+" "+s+'" text-anchor="middle" style="font: '+c+'px sans-serif">';for(r=0;r<t.length;r++)l+=donutSegment(e[r]/o,(e[r]+t[r])/o,n,i,colors[r]);l+='<circle cx="'+n+'" cy="'+n+'" r="'+i+'" fill="white" /><text dominant-baseline="central" transform="translate('+n+", "+n+')">'+o.toLocaleString()+"</text></svg></div>";var m=document.createElement("div");return m.innerHTML=l,m.firstChild}function donutSegment(a,e,t,o,r){e-a==1&&(e-=1e-5);var c=2*Math.PI*(a-.25),n=2*Math.PI*(e-.25),i=Math.cos(c),s=Math.sin(c),l=Math.cos(n),m=Math.sin(n),g=e-a>.5?1:0;return['<path d="M',t+o*i,t+o*s,"L",t+t*i,t+t*s,"A",t,t,0,g,1,t+t*l,t+t*m,"L",t+o*l,t+o*m,"A",o,o,0,g,0,t+o*i,t+o*s,'" fill="'+r+'" />'].join(" ")}mag1=["<",["get","mag"],2],mag2=["all",[">=",["get","mag"],2],["<",["get","mag"],3]],mag3=["all",[">=",["get","mag"],3],["<",["get","mag"],4]],mag4=["all",[">=",["get","mag"],4],["<",["get","mag"],5]],mag5=[">=",["get","mag"],5],colors=["#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c"];